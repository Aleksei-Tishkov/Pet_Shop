{% extends 'base.html' %}
{% load shop_tags %}

{% block title %}
    {{ title }}
{% endblock %}

{% block content %}
    {% load static %}
<div class="main_container vh-100 mt-5">
{% if object_list %}
<div class="container text-end">
<div class="p-1 table-responsive table__card mt-5 container back-drop text-start">
<table class="table table-striped table__card">
  <thead>
    <tr>
      <th scope="col">Product</th>
      <th scope="col">Quantity</th>
      <th scope="col">Price</th>
      <th scope="col">Total</th>
    </tr>
  </thead>
  <tbody>
    {% for p in object_list %}
    <tr>
      <td>{{ p.product.product_name }}</td>
      <td><p>{{ p.quantity }}
      <a class="edit_cart" data-form-url="{% url 'edit_cart' p.pk %}" title="Change quantity">
          <i class="fa-solid fa-pencil ms-1" aria-hidden="true"></i>
      </a></p>
      </td>
      <td>{{ p.product.product_price }}</td>
      <td>{{ p.quantity | multiply:p.product.product_price }}</td>
      <td><a href="delete/{{ p.pk }}" title="Remove from cart" class="delete__btn">
        <i class="fa-solid fa-square-minus"></i>
          </a>
    </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
    <h3 class="mt-5 text-end">Total: ${{ cart_sum }}</h3>
    {% if shipping_address %}
        <p>Your purchase will be shipped to {{ shipping_customer_postalcode }}, {{ shipping_customer_address }}.</p>
        <p>Need to ship to another address? <a href="{% url 'change_address' %}">Tell us where!</a></p>
    {% endif %}
    <a class="btn mt-2" id="clear-cart">Clear cart</a>
        {% if shipping_address %}
            <a class="btn btn-primary mt-2">{{ form.render }}</a>
        {% else %}
            <div class="text-center justify-content-center">
            <p class="mt-3">You must provide a shipping address to complete the purchase</p>
            <div class="row justify-content-center">
                <form method="post">
                {% csrf_token %}
                {{ form.non_field_errors }}
                {% for f in form %}
                        <div class="col-auto">
                        <p class="form__title">{{ f.label }} </p>
                        <p>{{ f }}</p>
                        <p>{{ f.errors }}</p>
                    </div>
                {% endfor %}
                    <button type="submit" class="btn btn-primary mt-4 col-2 h-auto">
                        Confirm address
                    </button>
                </form>
            </div>
            </div>
        {% endif %}
    <div class="container">

    </div>
</div>
{% else %}
    <h2 class="mt-5">Your cart is empty</h2>
{% endif %}
</div>

{% endblock %}
